-- dvzxit V2 | ESP + Aimbot + TeamCheck + HUD + FPS + FOV Visual (modelo que funciona)

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

local ESP_ENABLED = true
local AIMBOT_ENABLED = false
local TEAMCHECK_ENABLED = true
local AIMPART = "Head"
local AIMBOT_FOV = 120
local AIMBOT_SMOOTHNESS = 0.18
local BoxColor = Color3.fromRGB(0, 255, 0)
local TracerColor = Color3.fromRGB(255, 0, 0)
local FOVColor = Color3.fromRGB(255,255,60)

-- HUD
local panel = Drawing.new("Text")
panel.Size = 18
panel.Color = Color3.fromRGB(255,255,255)
panel.Position = Vector2.new(20,40)
panel.Visible = true

-- Keybinds
UserInputService.InputBegan:Connect(function(input, gp)
    if gp then return end
    if input.KeyCode == Enum.KeyCode.F1 then ESP_ENABLED = not ESP_ENABLED
    elseif input.KeyCode == Enum.KeyCode.F2 then AIMBOT_ENABLED = not AIMBOT_ENABLED
    elseif input.KeyCode == Enum.KeyCode.F3 then TEAMCHECK_ENABLED = not TEAMCHECK_ENABLED
    elseif input.KeyCode == Enum.KeyCode.F4 then AIMBOT_FOV = math.max(AIMBOT_FOV - 10, 20)
    elseif input.KeyCode == Enum.KeyCode.F5 then AIMBOT_FOV = math.min(AIMBOT_FOV + 10, 400)
    end
end)

local fps = 60
local lastFrame = os.clock()
RunService.RenderStepped:Connect(function()
    local now = os.clock()
    fps = 1/(now-lastFrame)
    lastFrame = now
    panel.Text = "dvzxit V2\n"
        .."[F1] ESP: "..tostring(ESP_ENABLED).."   "
        .."[F2] Aimbot: "..tostring(AIMBOT_ENABLED).."\n"
        .."[F3] TeamCheck: "..tostring(TEAMCHECK_ENABLED).."   "
        .."[F4/F5] FOV: "..tostring(AIMBOT_FOV).."\n"
        .."FPS: "..math.floor(fps)
end)

-- ESP/circle storage - separadas e limpas!
local tracers = {}
local boxes = {}
local lastCircle = nil

RunService.RenderStepped:Connect(function()
    -- Limpa desenhos do frame anterior
    for _,tracer in pairs(tracers) do pcall(function() tracer:Remove() end) end
    for _,box in pairs(boxes) do pcall(function() box:Remove() end) end
    if lastCircle then pcall(function() lastCircle:Remove() end) end
    tracers, boxes, lastCircle = {}, {}, nil

    local cam = workspace.CurrentCamera

    -- FOV visual
    if AIMBOT_ENABLED then
        local circle = Drawing.new("Circle")
        circle.Transparency = 0.7
        circle.Filled = false
        circle.Thickness = 2
        circle.Color = FOVColor
        circle.Position = Vector2.new(cam.ViewportSize.X/2, cam.ViewportSize.Y/2)
        circle.Radius = AIMBOT_FOV
        circle.Visible = true
        lastCircle = circle
    end

    -- ESP
    if ESP_ENABLED then
        for _,player in pairs(Players:GetPlayers()) do
            if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("Head") then
                local show = true
                if TEAMCHECK_ENABLED then
                    show = false
                    if player.Team ~= nil and LocalPlayer.Team ~= nil and player.Team ~= LocalPlayer.Team then
                        show = true
                    end
                end
                if show then
                    local head = player.Character.Head
                    local pos, onscreen = cam:WorldToViewportPoint(head.Position)
                    if onscreen then
                        -- Box
                        local size = 28
                        local box = Drawing.new("Quad")
                        box.Color = BoxColor
                        box.Thickness = 2
                        box.Visible = true
                        box.PointA = Vector2.new(pos.X-size/2, pos.Y-size)
                        box.PointB = Vector2.new(pos.X+size/2, pos.Y-size)
                        box.PointC = Vector2.new(pos.X+size/2, pos.Y+size/2)
                        box.PointD = Vector2.new(pos.X-size/2, pos.Y+size/2)
                        table.insert(boxes, box)
                        -- Tracer
                        local tracer = Drawing.new("Line")
                        tracer.Color = TracerColor
                        tracer.Thickness = 2
                        tracer.Visible = true
                        tracer.From = Vector2.new(cam.ViewportSize.X/2, cam.ViewportSize.Y)
                        tracer.To = Vector2.new(pos.X, pos.Y)
                        table.insert(tracers, tracer)
                    end
                end
            end
        end
    end
end)

-- Aimbot + TeamCheck + FOV
local function getClosestTarget()
    local cam = workspace.CurrentCamera
    local center = Vector2.new(cam.ViewportSize.X/2, cam.ViewportSize.Y/2)
    local closest, minDist = nil, AIMBOT_FOV
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild(AIMPART) then
            local doTarget = true
            if TEAMCHECK_ENABLED then
                doTarget = false
                if player.Team ~= nil and LocalPlayer.Team ~= nil and player.Team ~= LocalPlayer.Team then
                    doTarget = true
                end
            end
            if doTarget then
                local part = player.Character[AIMPART]
                local pos, onscreen = cam:WorldToViewportPoint(part.Position)
                if onscreen then
                    local dist = (Vector2.new(pos.X,pos.Y)-center).Magnitude
                    if dist < minDist then
                        minDist = dist
                        closest = part
                    end
                end
            end
        end
    end
    return closest
end

RunService.RenderStepped:Connect(function()
    if not AIMBOT_ENABLED then return end
    local target = getClosestTarget()
    if target then
        local cam = workspace.CurrentCamera
        cam.CFrame = cam.CFrame:Lerp(CFrame.new(cam.CFrame.Position, target.Position), AIMBOT_SMOOTHNESS)
    end
end)
